При коннекте юзер посылает токен в хедере. Мы получаем юзер инфу об этом токене из сервиса авторизации. Если все ок, то пускаем юзера в чат.
На стороне сервиса чата мы храним в каким комнатах находится каждый юзер. После верификации токена мы добавляем вс коннекшен в нужные комнаты.
Сообщения в чате обрабатываются с помощью кафки. Ключом сообщения является айди комнаты, в которую оно отправлено.
План такой:
1) Допилить клиент на беви, чтобы при коннекте отправлять токен.
2) Пока что токен может быть рандомным, и мы всегда возвращаем рандомный юзернейм.
3) Все сообщения доставляются всем юзерам через канал токио.
4) Все сообщения доставляются всем через кафку. Ключ у сообщения - айди юзера, который отправил сообщение. Так сообщения одного юзера всегда будут по порядку.
5) Допилить нормальную авторизацию - эндпоинт для верификации токена, который возвращает инфу по юзеру.
6) Сделать базу для сервиса чата - три таблицы - юзеры и чаты (комнаты), которых они состоят, плюс маппинг. Пока что можем как-то захардкодить комнаты.
7) Специальное сообщение от юзера "присоединиться к комнате". Вообще у юзеров должны быть права на присоединения к комнатам, но пока всем можно присоединяться всюду.
При получении делаем апдейт в базе, добавляем связь юзера с комнатой (если такая есть)
8) Сделать логику по броадкасту сообщения в ту комнату, в которую оно было послано. Добавить хедер к сообщению типа "комната_ид". Топик при этом пока что может быть один.